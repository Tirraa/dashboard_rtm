# How the internal _static analyzer_ helps you to build your blog better

A custom-built [internal _static analyzer_](/packages/static-analyzer/) is provided to assist you in ensuring the safety of your code and offering
errors-driven maintenance processes.

It is called during the `prebuild` phase, via [the _package.json file_](/package.json):

```bash
# package.json
static-analyzer start -- --posts-folder ./posts --blog-config-file ./src/config/blog.ts --i18n-locales-schema ./src/i18n/locales/schema.ts
```

## Keeping the `BlogArchitecture` type exhaustive

If the [_posts folder_](/posts/) looks like this:

```
├── patch-notes
│   ├── dashboard
│   │   ├── en
│   │   │   └── post-01.md
│   │   └── post-01.md
│   └── discord-bot
│       ├── en
│       │   └── post-01.md
│       └── post-01.md
└── patch-notes-bis
    ├── dashboard-bis
    │   ├── en
    │   │   └── post-01.md
    │   └── post-01.md
    └── discord-bot-bis
        ├── en
        │   └── post-01.md
        └── post-01.md
```

It means that the exhaustive `BlogArchitecture` type (in [the blog.ts config file](/src/config/blog.ts)) is:

```ts
// config/blog.ts
export type BlogArchitecture = {
  'patch-notes': 'dashboard' | 'discord-bot';
  'patch-notes-bis': 'dashboard-bis' | 'discord-bot-bis';
};
```

### Missing category in the `BlogArchitecture` type

Let's play a bit and "Forget" a category:

```ts
// config/blog.ts
export type BlogArchitecture = {
  'patch-notes': 'dashboard' | 'discord-bot';
};
```

We'll get an error:

> Failed to pass the static analysis! (./src/config/blog.ts)  
> Categories keys must be exhaustive!  
> Missing key: patch-notes-bis

### Unknown category in the `BlogArchitecture` type

Let's do a typo and write `'patch-notes-biss'` instead of `'patch-notes-bis'`:

```ts
// config/blog.ts
export type BlogArchitecture = {
  'patch-notes': 'dashboard' | 'discord-bot';
  'patch-notes-biss': 'dashboard-bis' | 'discord-bot-bis';
};
```

We'll get an error:

> Failed to pass the static analysis! (./src/config/blog.ts)  
> Unknown category key: 'patch-notes-biss'.  
> Available keys:  
> &nbsp;\- patch-notes  
> &nbsp;\- patch-notes-bis
>
> Categories keys must be exhaustive!  
> Missing key: patch-notes-bis

### Unknown subcategory in the `BlogArchitecture` type

Let's do a typo and write `'discord-bot-bise'` instead of `'discord-bot-bis'`:

```ts
// config/blog.ts
export type BlogArchitecture = {
  'patch-notes': 'dashboard' | 'discord-bot';
  'patch-notes-bis': 'dashboard-bis' | 'discord-bot-bise';
};
```

We'll get an error:

> Failed to pass the static analysis! (./src/config/blog.ts)  
> Unknown subcategory for the 'patch-notes-bis' category: discord-bot-bise  
> Available subcategories for the 'patch-notes-bis' category:  
> &nbsp;\- dashboard-bis  
> &nbsp;\- discord-bot-bis
>
> Subcategories keys must be exhaustive!  
> Missing key for the 'patch-notes-bis' category: discord-bot-bis

### Missing subcategory in the `BlogArchitecture` type

Now, let's try to forget a subcategory key:

```ts
// config/blog.ts
export type BlogArchitecture = {
  'patch-notes': 'dashboard';
  'patch-notes-bis': 'discord-bot-bis';
};
```

We'll get an error:

> Failed to pass the static analysis! (./src/config/blog.ts)  
> Subcategories keys must be exhaustive!  
> Missing key for the 'patch-notes' category: discord-bot  
> Missing key for the 'patch-notes-bis' category: dashboard-bis

... I guess we have covered all the unhappy paths.

## Keeping the i18n locale _schema_ exhaustive

Let write the exhaustive `BlogArchitecture` type, without error:

```ts
// config/blog.ts
export type BlogArchitecture = {
  'patch-notes': 'dashboard' | 'discord-bot';
  'patch-notes-bis': 'dashboard-bis' | 'discord-bot-bis';
};
```

And then build again.  
We'll get an error, now based on the _locale schema_ file.

### Missing category in the locale _schema_ file

Here is the error when you forget a category in the [_locale schema_ file](/src/i18n/locales/schema.ts):

> Failed to pass the static analysis! (./src/i18n/locales/schema.ts)  
> Categories keys must be exhaustive!  
> Missing key: patch-notes-bis

To fix it, let's turn:

```ts
// locales/schema.ts
'blog-categories': {
  'patch-notes': {
    _title: '__SCANNED_ON_BUILD_FIELD__',
    '_meta-description': '__SCANNED_ON_BUILD_FIELD__',

    'discord-bot': {
      title: '__SCANNED_ON_BUILD_FIELD__',
      'meta-description': '__SCANNED_ON_BUILD_FIELD__'
    },
    dashboard: {
      title: '__SCANNED_ON_BUILD_FIELD__',
      'meta-description': '__SCANNED_ON_BUILD_FIELD__'
    }
  }
}
```

To:

```ts
// locales/schema.ts
'blog-categories': {
  'patch-notes': {
    _title: '__SCANNED_ON_BUILD_FIELD__',
    '_meta-description': '__SCANNED_ON_BUILD_FIELD__',

    'discord-bot': {
      title: '__SCANNED_ON_BUILD_FIELD__',
      'meta-description': '__SCANNED_ON_BUILD_FIELD__'
    },
    dashboard: {
      title: '__SCANNED_ON_BUILD_FIELD__',
      'meta-description': '__SCANNED_ON_BUILD_FIELD__'
    }
  },

  'patch-notes-bis': {
    _title: '__SCANNED_ON_BUILD_FIELD__',
    '_meta-description': '__SCANNED_ON_BUILD_FIELD__',

    'discord-bot-bis': {
      title: '__SCANNED_ON_BUILD_FIELD__',
      'meta-description': '__SCANNED_ON_BUILD_FIELD__'
    },
    'dashboard-bis': {
      title: '__SCANNED_ON_BUILD_FIELD__',
      'meta-description': '__SCANNED_ON_BUILD_FIELD__'
    }
  }
}
```

With some adjustments, we will build without any error.  
(Read also: [Add a new blog category](./02.add-new-blog-category.md))

Now, let's introduce errors in the locales `blog-categories` schema.

### Missing i18n SEO required field in a category definition in the _locale schema_ file

If we skip an i18n SEO field in a category definition like this:

```ts
// locales/schema.ts
'blog-categories': {
  'patch-notes': {
    _title: '__SCANNED_ON_BUILD_FIELD__',
    '_meta-description': '__SCANNED_ON_BUILD_FIELD__',

    'discord-bot': {
      title: '__SCANNED_ON_BUILD_FIELD__',
      'meta-description': '__SCANNED_ON_BUILD_FIELD__'
    },
    dashboard: {
      title: '__SCANNED_ON_BUILD_FIELD__',
      'meta-description': '__SCANNED_ON_BUILD_FIELD__'
    }
  },

  'patch-notes-bis': {
    // * ... "Forget" _title attribute
    '_meta-description': '__SCANNED_ON_BUILD_FIELD__',

    'discord-bot-bis': {
      title: '__SCANNED_ON_BUILD_FIELD__',
      'meta-description': '__SCANNED_ON_BUILD_FIELD__'
    },
    'dashboard-bis': {
      title: '__SCANNED_ON_BUILD_FIELD__',
      'meta-description': '__SCANNED_ON_BUILD_FIELD__'
    }
  }
}
```

We'll get an error:

> Failed to pass the static analysis! (./src/i18n/locales/schema.ts)  
> Missing required i18n field for the 'patch-notes-bis' category from 'blog-categories': \_title

### Missing i18n SEO required field in a subcategory definition in the _locale schema_ file

```ts
// locales/schema.ts
'blog-categories': {
  'patch-notes': {
    _title: '__SCANNED_ON_BUILD_FIELD__',
    '_meta-description': '__SCANNED_ON_BUILD_FIELD__',

    'discord-bot': {
      title: '__SCANNED_ON_BUILD_FIELD__',
      'meta-description': '__SCANNED_ON_BUILD_FIELD__'
    },
    dashboard: {
      title: '__SCANNED_ON_BUILD_FIELD__',
      'meta-description': '__SCANNED_ON_BUILD_FIELD__'
    }
  },

  'patch-notes-bis': {
    _title: '__SCANNED_ON_BUILD_FIELD__',
    '_meta-description': '__SCANNED_ON_BUILD_FIELD__',

    'discord-bot-bis': {
      // * ... "Forget" title attribute
      'meta-description': '__SCANNED_ON_BUILD_FIELD__'
    },
    'dashboard-bis': {
      title: '__SCANNED_ON_BUILD_FIELD__',
      'meta-description': '__SCANNED_ON_BUILD_FIELD__'
    }
  }
}
```

We'll get an error:

> Failed to pass the static analysis! (./src/i18n/locales/schema.ts)  
> Missing required i18n field for the 'discord-bot-bis' subcategory from 'blog-categories.patch-notes-bis': title

### Missing subcategory in the _locale schema_ file

Let's try not to be exhaustive in `'patch-notes-bis'`:

```ts
// locales/schema.ts
'blog-categories': {
  'patch-notes': {
    _title: '__SCANNED_ON_BUILD_FIELD__',
    '_meta-description': '__SCANNED_ON_BUILD_FIELD__',

    'discord-bot': {
      title: '__SCANNED_ON_BUILD_FIELD__',
      'meta-description': '__SCANNED_ON_BUILD_FIELD__'
    },
    dashboard: {
      title: '__SCANNED_ON_BUILD_FIELD__',
      'meta-description': '__SCANNED_ON_BUILD_FIELD__'
    }
  },

  'patch-notes-bis': {
    _title: '__SCANNED_ON_BUILD_FIELD__',
    '_meta-description': '__SCANNED_ON_BUILD_FIELD__',

    // * ... "Forget" 'discord-bot-bis' attribute
    'dashboard-bis': {
      title: '__SCANNED_ON_BUILD_FIELD__',
      'meta-description': '__SCANNED_ON_BUILD_FIELD__'
    }
  }
}
```

We'll get an error:

> Failed to pass the static analysis! (./src/i18n/locales/schema.ts)  
> Subcategories keys must be exhaustive!  
> Missing key for the 'patch-notes-bis' category: discord-bot-bis

### Unknown subcategory in the _locale schema_ file

Let's try to introduce an unknown subcategory in `'patch-notes-bis'`:

```ts
// locales/schema.ts
'blog-categories': {
  'patch-notes': {
    _title: '__SCANNED_ON_BUILD_FIELD__',
    '_meta-description': '__SCANNED_ON_BUILD_FIELD__',

    'discord-bot': {
      title: '__SCANNED_ON_BUILD_FIELD__',
      'meta-description': '__SCANNED_ON_BUILD_FIELD__'
    },
    dashboard: {
      title: '__SCANNED_ON_BUILD_FIELD__',
      'meta-description': '__SCANNED_ON_BUILD_FIELD__'
    }
  },

  'patch-notes-bis': {
    _title: '__SCANNED_ON_BUILD_FIELD__',
    '_meta-description': '__SCANNED_ON_BUILD_FIELD__',

    'discord-bot-bis': {
      title: '__SCANNED_ON_BUILD_FIELD__',
      'meta-description': '__SCANNED_ON_BUILD_FIELD__'
    },
    'dashboard-bis': {
      title: '__SCANNED_ON_BUILD_FIELD__',
      'meta-description': '__SCANNED_ON_BUILD_FIELD__'
    },

    'unknown-subcategory': '__SCANNED_ON_BUILD_FIELD__' // * ... Unknown subcategory
  }
}
```

We'll get an error:

> Failed to pass the static analysis! (./src/i18n/locales/schema.ts)  
> Unknown subcategory for the 'patch-notes-bis' category: unknown-subcategory  
> Available subcategories for the 'patch-notes-bis' category:  
> &nbsp;\- dashboard-bis  
> &nbsp;\- discord-bot-bis

### Unknown category in the _locale schema_ file

Let's try to introduce an unknown category:

```ts
// locales/schema.ts
'blog-categories': {
  'patch-notes': {
    _title: '__SCANNED_ON_BUILD_FIELD__',
    '_meta-description': '__SCANNED_ON_BUILD_FIELD__',

    'discord-bot': {
      title: '__SCANNED_ON_BUILD_FIELD__',
      'meta-description': '__SCANNED_ON_BUILD_FIELD__'
    },
    dashboard: {
      title: '__SCANNED_ON_BUILD_FIELD__',
      'meta-description': '__SCANNED_ON_BUILD_FIELD__'
    }
  },

  'patch-notes-bis': {
    _title: '__SCANNED_ON_BUILD_FIELD__',
    '_meta-description': '__SCANNED_ON_BUILD_FIELD__',

    'discord-bot-bis': {
      title: '__SCANNED_ON_BUILD_FIELD__',
      'meta-description': '__SCANNED_ON_BUILD_FIELD__'
    },
    'dashboard-bis': {
      title: '__SCANNED_ON_BUILD_FIELD__',
      'meta-description': '__SCANNED_ON_BUILD_FIELD__'
    }
  },

  'unknown-category': '__SCANNED_ON_BUILD_FIELD__' // * ... Unknown category
}
```

We'll get an error:

> Failed to pass the static analysis! (./src/i18n/locales/schema.ts)  
> Unknown category key: 'unknown-category'.  
> Available keys:  
> &nbsp;\- patch-notes  
> &nbsp;\- patch-notes-bis

... I guess we have covered all the unhappy paths again.

---

Happy coding! :)
