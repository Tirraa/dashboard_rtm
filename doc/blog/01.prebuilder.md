# How the internal _prebuilder_ helps you to build your blog better

A custom-built [internal _prebuilder_](/packages/prebuilder/) is provided to assist you in ensuring the safety of your code and offering errors-driven
maintenance processes.

It is called during the `prebuild` phase, via [the _package.json file_](/package.json):

```bash
# package.json
cross-env BLOG_POSTS_FOLDER=./posts I18N_LOCALES_SCHEMA=./src/i18n/locales/schema.ts pnpm --filter @rtm/prebuilder start
```

> Notice that the "." in the paths you provide to the env variables actually refers to the project root folder

## Keeping the i18n locale _schema_ exhaustive

### Missing category in the locale _schema_ file

Here is the error when you forget a category in the [_locale schema_ file](/src/i18n/locales/schema.ts):

> Failed to pass the static analysis! (./src/i18n/locales/schema.ts)  
> Blog categories keys must be exhaustive!  
> Missing key: patch-notes-bis  
> (Update the 'blog-categories' object)

To fix it, let's turn:

```ts
// locales/schema.ts
'blog-categories': {
  'patch-notes': {
    _title: '__SCANNED_ON_BUILD_FIELD__',
    '_meta-description': '__SCANNED_ON_BUILD_FIELD__',

    'discord-bot': {
      title: '__SCANNED_ON_BUILD_FIELD__',
      'meta-description': '__SCANNED_ON_BUILD_FIELD__'
    },
    dashboard: {
      title: '__SCANNED_ON_BUILD_FIELD__',
      'meta-description': '__SCANNED_ON_BUILD_FIELD__'
    }
  }
}
```

To:

```ts
// locales/schema.ts
'blog-categories': {
  'patch-notes': {
    _title: '__SCANNED_ON_BUILD_FIELD__',
    '_meta-description': '__SCANNED_ON_BUILD_FIELD__',

    'discord-bot': {
      title: '__SCANNED_ON_BUILD_FIELD__',
      'meta-description': '__SCANNED_ON_BUILD_FIELD__'
    },
    dashboard: {
      title: '__SCANNED_ON_BUILD_FIELD__',
      'meta-description': '__SCANNED_ON_BUILD_FIELD__'
    }
  },

  'patch-notes-bis': {
    _title: '__SCANNED_ON_BUILD_FIELD__',
    '_meta-description': '__SCANNED_ON_BUILD_FIELD__',

    'discord-bot-bis': {
      title: '__SCANNED_ON_BUILD_FIELD__',
      'meta-description': '__SCANNED_ON_BUILD_FIELD__'
    },
    'dashboard-bis': {
      title: '__SCANNED_ON_BUILD_FIELD__',
      'meta-description': '__SCANNED_ON_BUILD_FIELD__'
    }
  }
}
```

With some adjustments, we will build without any error.  
(Read also: [Add a new blog category](./02.add-new-blog-category.md))

Now, let's introduce errors in the locales `blog-categories` schema.

### Missing i18n SEO required field in a category definition in the _locale schema_ file

If we skip an i18n SEO field in a category definition like this:

```ts
// locales/schema.ts
'blog-categories': {
  'patch-notes': {
    _title: '__SCANNED_ON_BUILD_FIELD__',
    '_meta-description': '__SCANNED_ON_BUILD_FIELD__',

    'discord-bot': {
      title: '__SCANNED_ON_BUILD_FIELD__',
      'meta-description': '__SCANNED_ON_BUILD_FIELD__'
    },
    dashboard: {
      title: '__SCANNED_ON_BUILD_FIELD__',
      'meta-description': '__SCANNED_ON_BUILD_FIELD__'
    }
  },

  'patch-notes-bis': {
    // * ... "Forget" _title attribute
    '_meta-description': '__SCANNED_ON_BUILD_FIELD__',

    'discord-bot-bis': {
      title: '__SCANNED_ON_BUILD_FIELD__',
      'meta-description': '__SCANNED_ON_BUILD_FIELD__'
    },
    'dashboard-bis': {
      title: '__SCANNED_ON_BUILD_FIELD__',
      'meta-description': '__SCANNED_ON_BUILD_FIELD__'
    }
  }
}
```

We'll get an error:

> Failed to pass the static analysis! (./src/i18n/locales/schema.ts)  
> Missing required i18n field for the 'patch-notes-bis' category from 'blog-categories': \_title

### Missing i18n SEO required field in a subcategory definition in the _locale schema_ file

```ts
// locales/schema.ts
'blog-categories': {
  'patch-notes': {
    _title: '__SCANNED_ON_BUILD_FIELD__',
    '_meta-description': '__SCANNED_ON_BUILD_FIELD__',

    'discord-bot': {
      title: '__SCANNED_ON_BUILD_FIELD__',
      'meta-description': '__SCANNED_ON_BUILD_FIELD__'
    },
    dashboard: {
      title: '__SCANNED_ON_BUILD_FIELD__',
      'meta-description': '__SCANNED_ON_BUILD_FIELD__'
    }
  },

  'patch-notes-bis': {
    _title: '__SCANNED_ON_BUILD_FIELD__',
    '_meta-description': '__SCANNED_ON_BUILD_FIELD__',

    'discord-bot-bis': {
      // * ... "Forget" title attribute
      'meta-description': '__SCANNED_ON_BUILD_FIELD__'
    },
    'dashboard-bis': {
      title: '__SCANNED_ON_BUILD_FIELD__',
      'meta-description': '__SCANNED_ON_BUILD_FIELD__'
    }
  }
}
```

We'll get an error:

> Failed to pass the static analysis! (./src/i18n/locales/schema.ts)  
> Missing required i18n field for the 'discord-bot-bis' subcategory from 'blog-categories.patch-notes-bis': title

### Missing subcategory in the _locale schema_ file

Let's try not to be exhaustive in `'patch-notes-bis'`:

```ts
// locales/schema.ts
'blog-categories': {
  'patch-notes': {
    _title: '__SCANNED_ON_BUILD_FIELD__',
    '_meta-description': '__SCANNED_ON_BUILD_FIELD__',

    'discord-bot': {
      title: '__SCANNED_ON_BUILD_FIELD__',
      'meta-description': '__SCANNED_ON_BUILD_FIELD__'
    },
    dashboard: {
      title: '__SCANNED_ON_BUILD_FIELD__',
      'meta-description': '__SCANNED_ON_BUILD_FIELD__'
    }
  },

  'patch-notes-bis': {
    _title: '__SCANNED_ON_BUILD_FIELD__',
    '_meta-description': '__SCANNED_ON_BUILD_FIELD__',

    // * ... "Forget" 'discord-bot-bis' attribute
    'dashboard-bis': {
      title: '__SCANNED_ON_BUILD_FIELD__',
      'meta-description': '__SCANNED_ON_BUILD_FIELD__'
    }
  }
}
```

We'll get an error:

> Failed to pass the static analysis! (./src/i18n/locales/schema.ts)  
> Blog subcategories keys must be exhaustive!  
> Missing key for the 'patch-notes-bis' category: discord-bot-bis  
> (Update the 'blog-categories' object)

### Unknown subcategory in the _locale schema_ file

Let's try to introduce an unknown subcategory in `'patch-notes-bis'`:

```ts
// locales/schema.ts
'blog-categories': {
  'patch-notes': {
    _title: '__SCANNED_ON_BUILD_FIELD__',
    '_meta-description': '__SCANNED_ON_BUILD_FIELD__',

    'discord-bot': {
      title: '__SCANNED_ON_BUILD_FIELD__',
      'meta-description': '__SCANNED_ON_BUILD_FIELD__'
    },
    dashboard: {
      title: '__SCANNED_ON_BUILD_FIELD__',
      'meta-description': '__SCANNED_ON_BUILD_FIELD__'
    }
  },

  'patch-notes-bis': {
    _title: '__SCANNED_ON_BUILD_FIELD__',
    '_meta-description': '__SCANNED_ON_BUILD_FIELD__',

    'discord-bot-bis': {
      title: '__SCANNED_ON_BUILD_FIELD__',
      'meta-description': '__SCANNED_ON_BUILD_FIELD__'
    },
    'dashboard-bis': {
      title: '__SCANNED_ON_BUILD_FIELD__',
      'meta-description': '__SCANNED_ON_BUILD_FIELD__'
    },

    'unknown-subcategory': '__SCANNED_ON_BUILD_FIELD__' // * ... Unknown subcategory
  }
}
```

We'll get an error:

> Failed to pass the static analysis! (./src/i18n/locales/schema.ts)  
> Unknown subcategory for the 'patch-notes-bis' category: unknown-subcategory  
> Available subcategories for the 'patch-notes-bis' category:  
> &nbsp;\- dashboard-bis  
> &nbsp;\- discord-bot-bis

### Unknown category in the _locale schema_ file

Let's try to introduce an unknown category:

```ts
// locales/schema.ts
'blog-categories': {
  'patch-notes': {
    _title: '__SCANNED_ON_BUILD_FIELD__',
    '_meta-description': '__SCANNED_ON_BUILD_FIELD__',

    'discord-bot': {
      title: '__SCANNED_ON_BUILD_FIELD__',
      'meta-description': '__SCANNED_ON_BUILD_FIELD__'
    },
    dashboard: {
      title: '__SCANNED_ON_BUILD_FIELD__',
      'meta-description': '__SCANNED_ON_BUILD_FIELD__'
    }
  },

  'patch-notes-bis': {
    _title: '__SCANNED_ON_BUILD_FIELD__',
    '_meta-description': '__SCANNED_ON_BUILD_FIELD__',

    'discord-bot-bis': {
      title: '__SCANNED_ON_BUILD_FIELD__',
      'meta-description': '__SCANNED_ON_BUILD_FIELD__'
    },
    'dashboard-bis': {
      title: '__SCANNED_ON_BUILD_FIELD__',
      'meta-description': '__SCANNED_ON_BUILD_FIELD__'
    }
  },

  'unknown-category': '__SCANNED_ON_BUILD_FIELD__' // * ... Unknown category
}
```

We'll get an error:

> Failed to pass the static analysis! (./src/i18n/locales/schema.ts)  
> Unknown blog category key: 'unknown-category'.  
> Available keys:  
> &nbsp;\- patch-notes  
> &nbsp;\- patch-notes-bis

... I guess we have covered all the unhappy paths again.

---

Happy coding! :)
