# Blog quirks

There are certain subtleties that you must know about the blog in this codebase.

## The `PostSchema` and `PostBase` types

There is a "weird" defined document type in [the _Contentlayer config file_](/contentlayer.config.ts), which is named `PostSchema`, based on
[`POST_SCHEMA_CONFIG`, defined in the _contentlayerConfigTweakers.ts_ file](/types/contentlayerConfigTweakers.ts).  
It has an empty `filePathPattern`, and no `computedFields`.

If you look in the `.contentlayer/generated/index.d.ts` file, you should understand quickly what is the `PostSchema`:

```ts
// .contentlayer/generated/index.d.ts
export type PostSchema = {
  _id: string;
  _raw: Local.RawDocumentData;
  type: 'PostSchema';
  title: string;
  metadescription: string;
  description?: string | undefined;
  date: IsoDateTimeString;
  url: string;
  body: Markdown;
};

export type BlogPostExample = {
  _id: string;
  _raw: Local.RawDocumentData;
  type: 'BlogPostExample';
  title: string;
  metadescription: string;
  description?: string | undefined;
  date: IsoDateTimeString;
  body: Markdown;
  url: string;
};
```

The purpose of this document type is to craft the _`PostBase` type_.  
To create a "Base" post type that rules all the others.

_Contentlayer_ generates a _phantom type_, which is the `type` field.  
This field ensures that you cannot "Confuse" one type of blog post with another one.  
But if you respectfully configure the `PostSchema` and all its related posts, then you can `Omit` this `type` field, and gain all the advantages of
the [_`PostBase` type_.](/src/types/Blog.ts)

```ts
// types/Blog.ts
import { PostSchema } from 'contentlayer/generated';

type ContentLayerPhantomType = 'type';
export type PostBase = Omit<PostSchema, ContentLayerPhantomType>;
```

Therefore, it is important to maintain the `PostSchema` declaration if you add any field to your blog posts, to maintain the consistency of the
_`PostBase` type_ which offers the ability to apply generic processing to _blog posts_.

In order to make this process less error-prone, the configuration structure is quite rigorously typed.

## Adding a blog post field

Let's assume that [the _contentlayer config file_](/contentlayer.config.ts) defines two documents types: `PatchPost` and `PatchPostBis`.

```ts
// contentlayer.config.ts
const documentsTypesMetadatas: DocumentsTypesMetadatas = {
  PatchPost: {
    name: 'PatchPost',
    filePathPattern: '**/patch-notes/**/*.md'
  },
  PatchPostBis: {
    name: 'PatchPostBis',
    filePathPattern: '**/patch-notes-bis/**/*.md'
  }
} as const;
```

Now, let's assume that we want to add a `draft` field!

Let's edit the `BaseField` type from [_the contentlayerConfigTweakers.ts file_](/types/contentlayerConfigTweakers.ts):

Let:

```ts
// contentlayerConfigTweakers.ts
export type BaseFields = {
  title: { type: 'string'; required: true };
  description: { type: 'string'; required: false };
  metadescription: { type: 'string'; required: true };
  date: { type: 'date'; required: true };
  url: { type: 'string'; required: true };
};
```

Become:

```ts
// contentlayerConfigTweakers.ts
export type BaseFields = {
  title: { type: 'string'; required: true };
  description: { type: 'string'; required: false };
  metadescription: { type: 'string'; required: true };
  date: { type: 'date'; required: true };
  url: { type: 'string'; required: true };
  draft: { type: 'boolean'; required: true }; // * ... Added 'draft' field.
};
```

Then, adjust the `fields` object in `POST_SCHEMA_CONFIG` (you can just copy and paste all the content of `BaseFields`).

```ts
// contentlayerConfigTweakers.ts
export const POST_SCHEMA_CONFIG: DocumentsConfigType = {
  name: 'PostSchema',
  filePathPattern: '',
  fields: {
    title: { type: 'string', required: true },
    description: { type: 'string', required: false },
    metadescription: { type: 'string', required: true },
    date: { type: 'date', required: true },
    url: { type: 'string', required: true },
    draft: { type: 'boolean', required: true } // * ... Added 'draft' field here too.
  }
} as const;
```

Then, adjust the `fields` variable in [_the Contentlayer config file_](/contentlayer.config.ts):

```ts
// contentlayer.config.ts
const fields = {
  title: { type: 'string', required: true },
  metadescription: { type: 'string', required: true },
  description: { type: 'string', required: false },
  date: { type: 'date', required: true },
  draft: { type: 'boolean', required: true } // * ... Added 'draft' field here too.
} as const satisfies DocumentsFields;
```

Then, let's generate again the _Contentlayer_ types!

```ts
// .contentlayer/generated/index.d.ts
export type PatchPost = {
  _id: string;
  _raw: Local.RawDocumentData;
  type: 'PatchPost';
  title: string;
  metadescription: string;
  description?: string | undefined;
  date: IsoDateTimeString;
  draft: boolean; // * ... Hello!
  body: Markdown;
  url: string;
};

export type PatchPostBis = {
  _id: string;
  _raw: Local.RawDocumentData;
  type: 'PatchPostBis';
  title: string;
  metadescription: string;
  description?: string | undefined;
  date: IsoDateTimeString;
  draft: boolean; // * ... Hello!
  body: Markdown;
  url: string;
};

export type PostSchema = {
  _id: string;
  _raw: Local.RawDocumentData;
  type: 'PostSchema';
  title: string;
  description?: string | undefined;
  metadescription: string;
  date: IsoDateTimeString;
  url: string;
  draft: boolean; // * ... Hello!
  body: Markdown;
};
```

And `PostBase` is now equal to:

```ts
type PostBase = {
  title: string;
  date: string;
  metadescription: string;
  description?: string | undefined;
  url: string;
  draft: boolean; // * ... Hello there!
  _id: string;
  _raw: RawDocumentData;
  body: Markdown;
};
```

## Adding a COMPUTED blog post field

Although it doesn't really make sense, let's assume that our new field, _draft_, should be a _computed field_.

Let's edit the `DocumentsComputedFieldsKey` type in the [_contentlayerConfigTweakers.ts_ file](/types/contentlayerConfigTweakers.ts)

So:

```ts
// types/contentlayerConfigTweakers.ts
export type DocumentsComputedFieldsKey = MakeDocumentsBaseFieldsSumType<'url'>;
```

Becomes:

```ts
// types/contentlayerConfigTweakers.ts
export type DocumentsComputedFieldsKey = MakeDocumentsBaseFieldsSumType<'url' | 'draft'>;
```

Then, adjust the `fields` variable in [_the Contentlayer config file_](/contentlayer.config.ts):

```ts
// contentlayer.config.ts
const fields = {
  title: { type: 'string', required: true },
  metadescription: { type: 'string', required: true },
  description: { type: 'string', required: false },
  date: { type: 'date', required: true }
  // draft: { type: 'boolean', required: true } // * ... Remove this, since it is now a computed field, and not "just" a field.
} as const satisfies DocumentsFields;
```

And then, adjust the `computedFields` variable, still in [_the Contentlayer config file_](/contentlayer.config.ts):

```ts
// contentlayer.config.ts
const computedFields = {
  url: { type: 'string', resolve: (post: any) => `/${post._raw.flattenedPath}` },
  draft: { type: 'boolean', resolve: () => true } // * ... Dummy computation function, just for the example
} as const satisfies DocumentsComputedFields;
```

And we are done.  
Now, _draft_ is a _computed field_.

---

Happy coding! :)
